# PA4 虚实交错的魔法: 分时多任务

    我悲伤的PA4

## 多道程序

    其实多道程序的原理很简单，我在回家的高铁上花一小时就知道该咋做了。诚如PA4开篇所言，确实不再有提示了，一切得靠自己。OK。其实很简单。_kcontext() -> schedule() -> _EVENT_YIELD -> __am_asm_trap() 这一些实现下来非常的简单。我唯一卡壳的地方就是__am_asm_trap里面需要新添加的一行汇编，一开始搞错寄存器编号了，实际应该为a0，导致浪费了一会时间。

    多道程序实现的结果就是一边输出hello一边仙剑。

## 超越容量的界限

    虚拟地址和物理地址之间的转换，听起来也不是很有难度。按部就班的实现就行。查riscv32手册，实现其虚存的转换。然后分配堆的地方似乎也不是很有难度，按照它说的来做就ok。我确实成功单独运行了仙剑；可是当我想一边仙剑一边hello的时候，我发现hello里的printf没有输出。我关掉仙剑，单独跑了hello，还是一样的结果。我意识到，肯定是我哪里实现的有问题，但我找不出来 :( 

## 来自外部的声音

    这一部分也很简单，我实现的很顺利，我已经提交了一部分的代码，运行之后可以看见我的时钟中断的输出。

    当然，在这一部分我因为需要一些寄存器，所以我重新排布了我的寄存器（scause, sstatus, satp等)的位置，将他们都放到了cpu里面，之前乱七八糟的放别处了，不太好。

## 编写不朽的传奇

    这一部分我没有做，我也不打算做了，因为也比较简单，加上我虚存那部分存在Bug，也没办法继续推进进度了。还是比较可惜和遗憾的！
